general:
  artifacts:
    - build/libs

machine:
  java:
    version: oraclejdk7
  post:
    - pushd parquet-mr && ./build/install_deps.sh && popd
  environment:
    TERM: dumb
    TEST_CODECS: gzip,snappy,uncompressed

dependencies:
  override:
    - ./gradlew --console=plain --stacktrace resolveConfigurations

test:
  override:
    - ./gradlew --console=plain --stacktrace --parallel build check
  post:
    - cp -R build/reports/* $CIRCLE_ARTIFACTS
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -regex ".*/build/test-results/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \; :
        parallel: true

deployment:
  release:
    tag: /[0-9]+(?:\.[0-9]+)+-palantir[0-9]+/
    commands:
      - ./gradlew -is bintrayUpload

